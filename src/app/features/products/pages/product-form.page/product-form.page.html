@if(loadingEditData()){
<app-form-skeleton></app-form-skeleton>
}@else {
<div class="page">
    <header class="header">
        <div class="brand">
            <span class="brand-text">BANCO</span>
        </div>
    </header>

    <main class="card">
        <h1 class="title">
            {{ isEdit ? 'Formulario de Edición' : 'Formulario de Registro' }}
        </h1>

        <div class="divider"></div>

        <form class="form" [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="grid">

                <div class="field">
                    <label>ID</label>
                    <input type="text" formControlName="id"
                        [class.invalid]="form.controls.id.touched && form.controls.id.invalid" />

                    @if (hasError('id','required')) {
                    <small class="error">ID es requerido.</small>
                    }
                    @if (hasError('id','minlength')) {
                    <small class="error">Mínimo 3 caracteres.</small>
                    }
                    @if (hasError('id','maxlength')) {
                    <small class="error">Máximo 10 caracteres.</small>
                    }
                    @if (hasError('id','idTaken')) {
                    <small class="error">Este ID ya existe.</small>
                    }
                </div>

                <div class="field">
                    <label>Nombre</label>
                    <input type="text" formControlName="name"
                        [class.invalid]="form.controls.name.touched && form.controls.name.invalid" />

                    @if (hasError('name','required')) {
                    <small class="error">Nombre es requerido.</small>
                    }
                    @if (hasError('name','minlength')) {
                    <small class="error">Mínimo 5 caracteres.</small>
                    }
                    @if (hasError('name','maxlength')) {
                    <small class="error">Máximo 100 caracteres.</small>
                    }
                </div>

                <div class="field">
                    <label>Descripción</label>
                    <input type="text" formControlName="description"
                        [class.invalid]="form.controls.description.touched && form.controls.description.invalid" />

                    @if (hasError('description','required')) {
                    <small class="error">Descripción es requerida.</small>
                    }
                    @if (hasError('description','minlength')) {
                    <small class="error">Mínimo 10 caracteres.</small>
                    }
                    @if (hasError('description','maxlength')) {
                    <small class="error">Máximo 200 caracteres.</small>
                    }
                </div>

                <div class="field">
                    <label>Logo</label>
                    <input type="text" formControlName="logo"
                        [class.invalid]="form.controls.logo.touched && form.controls.logo.invalid" />

                    @if (hasError('logo','required')) {
                    <small class="error">Logo es requerido.</small>
                    }
                </div>

                <div class="field">
                    <label>Fecha de Liberación</label>
                    <input type="date" formControlName="date_release" [min]="todayStr"
                        [class.invalid]="form.controls.date_release.touched && form.controls.date_release.invalid" />

                    @if (hasError('date_release','required')) {
                    <small class="error">Fecha de liberación es requerida.</small>
                    }
                    @if (hasError('date_release','minToday')) {
                    <small class="error">Debe ser hoy o una fecha futura.</small>
                    }
                </div>

                <div class="field">
                    <label>Fecha de Revisión</label>
                    <input type="date" formControlName="date_revision"
                        [class.invalid]="(form.controls.date_revision.touched && form.controls.date_revision.invalid) || (form.touched && form.hasError('revisionNotOneYear'))" />

                    @if (hasError('date_revision','required')) {
                    <small class="error">Fecha de revisión es requerida.</small>
                    }
                    @if (form.touched && form.hasError('revisionNotOneYear')) {
                    <small class="error">
                        Debe ser exactamente 1 año después de la liberación.
                    </small>
                    }
                </div>
            </div>

            <div class="actions">
                <button type="button" class="btn btn-secondary" (click)="onReset()">
                    Reiniciar
                </button>

                <button type="submit" class="btn btn-warning">
                    {{ isEdit ? 'Actualizar' : 'Agregar' }}
                </button>
            </div>

            @if (submitError) {
            <p class="submit-error">{{ submitError }}</p>
            }
        </form>
    </main>
</div>
}